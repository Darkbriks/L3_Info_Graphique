<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>TP5 Three.js - Exo 5</title>
    <style>
        body {
            margin: 0;
        }
    </style>
</head>

<body>

<!-- Ajouter un bouton pour centré la caméra sur chaque planète -->
<div id="focus-buttons"></div>

<!-- inclusion de la librairie Three.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.js"></script>

<script src="js/mesObjets.js"></script>
<script src="js/CelestialBody.js"></script>
<script src="js/CelestialBodyData.js"></script>
<script src="js/ArcballControls.js"></script>

<script>
    const clock = new THREE.Clock();

    // Création de la caméra
    const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.01, 10000000);
    // placer la caméra au dessus du plan de l'écliptique
    camera.position.set(0, 100000, 0);
    camera.lookAt(0, 0, 0);

    // création de la scène
    const scene = new THREE.Scene();

    // création du rendu
    const renderer = new THREE.WebGLRenderer();
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // ajout d'un contrôleur de caméra
    let control = new THREE.ArcballControls(camera, renderer.domElement, scene);

    // Ajout d'une skybox
    const loader = new THREE.TextureLoader();
    loader.load('Images/2k_stars_milky_way.jpg', function (texture) {
        texture.mapping = THREE.EquirectangularReflectionMapping;
        scene.background = texture;
    });

    /*let Sun = new CelestialBody({
        name: 'Sun',
        radius: 696342,
        semiMajorAxis: 0,
        eccentricity: 0,
        inclination: 0,
        argumentOfPeriapsis: 0,
        longitudeOfAscendingNode: 0,
        meanAnomaly: 0,
        orbitalPeriod: 0,
        parent: null,
        axialTilt: DEG_TO_RAD(7.25),
        selfRotationPeriod: DAY_TO_SEC(27.28),
        textureUrl: 'Images/sun2k.jpg',
        lock: true,
    })
    let Mercury = new CelestialBody({
        name: 'Mercury',
        radius: 2439.7,
        semiMajorAxis: 57909227,
        eccentricity: 0.20563069,
        inclination: DEG_TO_RAD(7.00487),
        argumentOfPeriapsis: DEG_TO_RAD(29.124),
        longitudeOfAscendingNode: DEG_TO_RAD(48.331),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(87.9691),
        parent: Sun,
        axialTilt: DEG_TO_RAD(0.034),
        selfRotationPeriod: DAY_TO_SEC(58.646),
        textureUrl: 'Images/mercurymap.jpg',
        helperColor: 0x00ff00,
    })
    let Venus = new CelestialBody({
        name: 'Venus',
        radius: 6051.8,
        semiMajorAxis: 108209475,
        eccentricity: 0.00677188,
        inclination: DEG_TO_RAD(3.39471),
        argumentOfPeriapsis: DEG_TO_RAD(0/*54.884),
        longitudeOfAscendingNode: DEG_TO_RAD(76.680),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(224.701),
        parent: Sun,
        axialTilt: DEG_TO_RAD(177.36),
        selfRotationPeriod: DAY_TO_SEC(-243.025),
        textureUrl: 'Images/venusmap.jpg',
        helperColor: 0x00ffff,
    })
    let Earth = new CelestialBody({
        name: 'Earth',
        radius: 6378.137,
        semiMajorAxis: 149597887.5,
        eccentricity: 0.01671022,
        inclination: 0,
        argumentOfPeriapsis: DEG_TO_RAD(288.064),
        longitudeOfAscendingNode: DEG_TO_RAD(174.873),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(365.256363),
        parent: Sun,
        axialTilt: DEG_TO_RAD(23.4366907752),
        selfRotationPeriod: DAY_TO_SEC(0.99726949),
        textureUrl: 'Images/earthmap1k.jpg',
    })
    let Moon = new CelestialBody({
        name: 'Moon',
        radius: 1737.1,
        semiMajorAxis: 384400,
        eccentricity: 0.0549,
        inclination: DEG_TO_RAD(5.145),
        argumentOfPeriapsis: DEG_TO_RAD(125.08),
        longitudeOfAscendingNode: DEG_TO_RAD(318.15),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(27.321582),
        parent: Earth,
        axialTilt: DEG_TO_RAD(1.5424),
        selfRotationPeriod: DAY_TO_SEC(27.321582),
        textureUrl: 'Images/moonmap1k.jpg',
    })
    let Mars = new CelestialBody({
        name: 'Mars',
        radius: 3396.2,
        semiMajorAxis: 227939100,
        eccentricity: 0.09341233,
        inclination: DEG_TO_RAD(1.85061),
        argumentOfPeriapsis: DEG_TO_RAD(286.502),
        longitudeOfAscendingNode: DEG_TO_RAD(49.558),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(686.971),
        parent: Sun,
        axialTilt: DEG_TO_RAD(25.19),
        selfRotationPeriod: DAY_TO_SEC(1.02595676),
        textureUrl: 'Images/marsmap.jpg',
    })
    let Deimos = new CelestialBody({
        name: 'Deimos',
        radius: 6.2,
        semiMajorAxis: 23459.4,
        eccentricity: 0.00033,
        inclination: DEG_TO_RAD(1.788),
        argumentOfPeriapsis: DEG_TO_RAD(24.525),
        longitudeOfAscendingNode: DEG_TO_RAD(151.46),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(1.26244),
        parent: Mars,
        axialTilt: DEG_TO_RAD(0.93),
        selfRotationPeriod: DAY_TO_SEC(1.26244),
        textureUrl: 'Images/deimos.webp',
    })
    let Phobos = new CelestialBody({
        name: 'Phobos',
        radius: 11.1,
        semiMajorAxis: 9376.2,
        eccentricity: 0.0151,
        inclination: DEG_TO_RAD(1.093),
        argumentOfPeriapsis: DEG_TO_RAD(150.057),
        longitudeOfAscendingNode: DEG_TO_RAD(207.82),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(0.31891),
        parent: Mars,
        axialTilt: DEG_TO_RAD(1.093),
        selfRotationPeriod: DAY_TO_SEC(0.31891),
        textureUrl: 'Images/phobos.jpg',
    })
    let Ceres = new CelestialBody({
        name: 'Ceres',
        radius: 469.73,
        semiMajorAxis: 413767000,
        eccentricity: 0.079903,
        inclination: DEG_TO_RAD(10.587),
        argumentOfPeriapsis: DEG_TO_RAD(72.556),
        longitudeOfAscendingNode: DEG_TO_RAD(80.305),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(1683.14570801),
        parent: Sun,
        axialTilt: DEG_TO_RAD(4.0),
        selfRotationPeriod: DAY_TO_SEC(0.3781),
        textureUrl: 'Images/ceres.webp',
    })
    let Jupiter = new CelestialBody({
        name: 'Jupiter',
        radius: 71492,
        semiMajorAxis: 778547200,
        eccentricity: 0.04839266,
        inclination: DEG_TO_RAD(1.30530),
        argumentOfPeriapsis: DEG_TO_RAD(273.867),
        longitudeOfAscendingNode: DEG_TO_RAD(100.464),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(4332.59),
        parent: Sun,
        axialTilt: DEG_TO_RAD(3.13),
        selfRotationPeriod: DAY_TO_SEC(0.41354),
        textureUrl: 'Images/jupiter.jpg',
    })
    let Io = new CelestialBody({
        name: 'Io',
        radius: 1821.6,
        semiMajorAxis: 421700,
        eccentricity: 0.0041,
        inclination: DEG_TO_RAD(0.05),
        argumentOfPeriapsis: DEG_TO_RAD(84.129),
        longitudeOfAscendingNode: DEG_TO_RAD(43.977),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(1.769),
        parent: Jupiter,
        axialTilt: DEG_TO_RAD(0.05),
        selfRotationPeriod: DAY_TO_SEC(1.769),
        textureUrl: 'Images/io.webp',
    })
    let Europa = new CelestialBody({
        name: 'Europa',
        radius: 1560.8,
        semiMajorAxis: 671034,
        eccentricity: 0.0094,
        inclination: DEG_TO_RAD(0.471),
        argumentOfPeriapsis: DEG_TO_RAD(219.106),
        longitudeOfAscendingNode: DEG_TO_RAD(219.106),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(3.551),
        parent: Jupiter,
        axialTilt: DEG_TO_RAD(0.471),
        selfRotationPeriod: DAY_TO_SEC(3.551),
        textureUrl: 'Images/europa.webp',
    })
    let Ganymede = new CelestialBody({
        name: 'Ganymede',
        radius: 2634.1,
        semiMajorAxis: 1070412,
        eccentricity: 0.0013,
        inclination: DEG_TO_RAD(0.195),
        argumentOfPeriapsis: DEG_TO_RAD(63.552),
        longitudeOfAscendingNode: DEG_TO_RAD(63.552),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(7.154),
        parent: Jupiter,
        axialTilt: DEG_TO_RAD(0.195),
        selfRotationPeriod: DAY_TO_SEC(7.154),
        textureUrl: 'Images/ganymede.webp',
    })
    let Callisto = new CelestialBody({
        name: 'Callisto',
        radius: 2410.3,
        semiMajorAxis: 1882709,
        eccentricity: 0.0074,
        inclination: DEG_TO_RAD(0.192),
        argumentOfPeriapsis: DEG_TO_RAD(298.848),
        longitudeOfAscendingNode: DEG_TO_RAD(298.848),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(16.689),
        parent: Jupiter,
        axialTilt: DEG_TO_RAD(0.192),
        selfRotationPeriod: DAY_TO_SEC(16.689),
        textureUrl: 'Images/callisto.webp',
    })
    let Saturn = new CelestialBody({
        name: 'Saturn',
        radius: 60268,
        semiMajorAxis: 1433449370,
        eccentricity: 0.055723219,
        inclination: DEG_TO_RAD(2.48446),
        argumentOfPeriapsis: DEG_TO_RAD(339.392),
        longitudeOfAscendingNode: DEG_TO_RAD(113.665),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(10759.22),
        parent: Sun,
        axialTilt: DEG_TO_RAD(26.73),
        selfRotationPeriod: DAY_TO_SEC(0.444),
        textureUrl: 'Images/saturnmap.jpg',
    }) // TODO: add rings ?
    let Titan = new CelestialBody({
        name: 'Titan',
        radius: 2574.7,
        semiMajorAxis: 1221870,
        eccentricity: 0.0288,
        inclination: DEG_TO_RAD(0.34854),
        argumentOfPeriapsis: DEG_TO_RAD(28.060),
        longitudeOfAscendingNode: DEG_TO_RAD(168.803),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(15.945),
        parent: Saturn,
        axialTilt: DEG_TO_RAD(0.34854),
        selfRotationPeriod: DAY_TO_SEC(15.945),
        textureUrl: 'Images/titan.webp',
    })
    let Rhea = new CelestialBody({
        name: 'Rhea',
        radius: 763.8,
        semiMajorAxis: 527108,
        eccentricity: 0.001258,
        inclination: DEG_TO_RAD(0.345),
        argumentOfPeriapsis: DEG_TO_RAD(113.949),
        longitudeOfAscendingNode: DEG_TO_RAD(345.944),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(4.518),
        parent: Saturn,
        axialTilt: DEG_TO_RAD(0.345),
        selfRotationPeriod: DAY_TO_SEC(4.518),
        textureUrl: 'Images/rhea.webp',
    })
    let Iapetus = new CelestialBody({
        name: 'Iapetus',
        radius: 734.5,
        semiMajorAxis: 3560840,
        eccentricity: 0.028613,
        inclination: DEG_TO_RAD(15.47),
        argumentOfPeriapsis: DEG_TO_RAD(75.62),
        longitudeOfAscendingNode: DEG_TO_RAD(143.62),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(79.3215),
        parent: Saturn,
        axialTilt: DEG_TO_RAD(15.47),
        selfRotationPeriod: DAY_TO_SEC(79.3215),
        textureUrl: 'Images/iapetus.webp',
    })
    let Dioné = new CelestialBody({
        name: 'Dioné',
        radius: 561.4,
        semiMajorAxis: 377396,
        eccentricity: 0.0022,
        inclination: DEG_TO_RAD(0.019),
        argumentOfPeriapsis: DEG_TO_RAD(284.96),
        longitudeOfAscendingNode: DEG_TO_RAD(169.57),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(2.7369),
        parent: Saturn,
        axialTilt: DEG_TO_RAD(0.019),
        selfRotationPeriod: DAY_TO_SEC(2.7369),
        textureUrl: 'Images/dione.webp',
    })
    let Téthys = new CelestialBody({
        name: 'Téthys',
        radius: 531.1,
        semiMajorAxis: 294619,
        eccentricity: 0.0001,
        inclination: DEG_TO_RAD(1.12),
        argumentOfPeriapsis: DEG_TO_RAD(257.47),
        longitudeOfAscendingNode: DEG_TO_RAD(328.08),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(1.8878),
        parent: Saturn,
        axialTilt: DEG_TO_RAD(1.12),
        selfRotationPeriod: DAY_TO_SEC(1.8878),
        textureUrl: 'Images/tethys.webp',
    })
    let Encelade = new CelestialBody({
        name: 'Encelade',
        radius: 252.1,
        semiMajorAxis: 238042,
        eccentricity: 0.0047,
        inclination: DEG_TO_RAD(0.009),
        argumentOfPeriapsis: DEG_TO_RAD(342.51),
        longitudeOfAscendingNode: DEG_TO_RAD(168.69),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(1.3702),
        parent: Saturn,
        axialTilt: DEG_TO_RAD(0.009),
        selfRotationPeriod: DAY_TO_SEC(1.3702),
        textureUrl: 'Images/enceladus.webp',
    })
    let Mimas = new CelestialBody({
        name: 'Mimas',
        radius: 198.2,
        semiMajorAxis: 185539,
        eccentricity: 0.0196,
        inclination: DEG_TO_RAD(1.574),
        argumentOfPeriapsis: DEG_TO_RAD(130.72),
        longitudeOfAscendingNode: DEG_TO_RAD(342.13),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(0.942),
        parent: Saturn,
        axialTilt: DEG_TO_RAD(1.574),
        selfRotationPeriod: DAY_TO_SEC(0.942),
        textureUrl: 'Images/mimas.webp',
    })
    let Uranus = new CelestialBody({
        name: 'Uranus',
        radius: 25559,
        semiMajorAxis: 2870658186,
        eccentricity: 0.046381,
        inclination: DEG_TO_RAD(0.772),
        argumentOfPeriapsis: DEG_TO_RAD(96.541),
        longitudeOfAscendingNode: DEG_TO_RAD(74.229),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(30685.4),
        parent: Sun,
        axialTilt: DEG_TO_RAD(97.77),
        selfRotationPeriod: DAY_TO_SEC(-0.71833),
        textureUrl: 'Images/uranus.webp',
    })
    let Neptune = new CelestialBody({
        name: 'Neptune',
        radius: 24764,
        semiMajorAxis: 4498396441,
        eccentricity: 0.011214269,
        inclination: DEG_TO_RAD(1.767975),
        argumentOfPeriapsis: DEG_TO_RAD(265.646853),
        longitudeOfAscendingNode: DEG_TO_RAD(131.794310),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(60189),
        parent: Sun,
        axialTilt: DEG_TO_RAD(28.32),
        selfRotationPeriod: DAY_TO_SEC(0.67125),
        textureUrl: 'Images/neptune.webp',
    })
    let Triton = new CelestialBody({
        name: 'Triton',
        radius: 1353.4,
        semiMajorAxis: 354759,
        eccentricity: 0.000016,
        inclination: DEG_TO_RAD(156.865),
        argumentOfPeriapsis: DEG_TO_RAD(66.129),
        longitudeOfAscendingNode: DEG_TO_RAD(176.630),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(-5.876854),
        parent: Neptune,
        axialTilt: DEG_TO_RAD(156.865),
        selfRotationPeriod: DAY_TO_SEC(-5.876854),
        textureUrl: 'Images/triton.webp',
    })
    let Pluto = new CelestialBody({
        name: 'Pluto',
        radius: 1188.3,
        semiMajorAxis: 5906440628,
        eccentricity: 0.2488,
        inclination: DEG_TO_RAD(17.16),
        argumentOfPeriapsis: DEG_TO_RAD(113.763),
        longitudeOfAscendingNode: DEG_TO_RAD(110.299),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(90560),
        parent: Sun,
        axialTilt: DEG_TO_RAD(119.61),
        selfRotationPeriod: DAY_TO_SEC(6.387230),
        textureUrl: 'Images/pluto.webp',
    })
    let Charon = new CelestialBody({
        name: 'Charon',
        radius: 606,
        semiMajorAxis: 19591,
        eccentricity: 0.0022,
        inclination: DEG_TO_RAD(0.001),
        argumentOfPeriapsis: DEG_TO_RAD(38.373),
        longitudeOfAscendingNode: DEG_TO_RAD(224.365),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(6.387230),
        parent: Pluto,
        axialTilt: DEG_TO_RAD(0.001),
        selfRotationPeriod: DAY_TO_SEC(6.387230),
        textureUrl: 'Images/charon.webp',
    })
    let Haumea = new CelestialBody({
        name: 'Haumea',
        radius: 620,
        semiMajorAxis: 6.4525e9,
        eccentricity: 0.195,
        inclination: DEG_TO_RAD(28.19),
        argumentOfPeriapsis: DEG_TO_RAD(239.61),
        longitudeOfAscendingNode: DEG_TO_RAD(121.77),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(103000),
        parent: Sun,
        axialTilt: DEG_TO_RAD(0),
        selfRotationPeriod: DAY_TO_SEC(3.915),
        textureUrl: 'Images/haumea.webp',
    })
    let Makemake = new CelestialBody({
        name: 'Makemake',
        radius: 715,
        semiMajorAxis: 6.8503e9,
        eccentricity: 0.159,
        inclination: DEG_TO_RAD(29.00685),
        argumentOfPeriapsis: DEG_TO_RAD(79.365),
        longitudeOfAscendingNode: DEG_TO_RAD(296.0),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(113000),
        parent: Sun,
        axialTilt: DEG_TO_RAD(0),
        selfRotationPeriod: DAY_TO_SEC(7.77),
        textureUrl: 'Images/make-make.webp',
    })
    let Eris = new CelestialBody({
        name: 'Eris',
        radius: 1163,
        semiMajorAxis: 10.117e9,
        eccentricity: 0.44177,
        inclination: DEG_TO_RAD(44.187),
        argumentOfPeriapsis: DEG_TO_RAD(151.89),
        longitudeOfAscendingNode: DEG_TO_RAD(35.951),
        meanAnomaly: 0,
        orbitalPeriod: DAY_TO_SEC(204000),
        parent: Sun,
        axialTilt: DEG_TO_RAD(0),
        selfRotationPeriod: DAY_TO_SEC(25.9),
        textureUrl: 'Images/eris.webp',
    })*/

    celestialBodiesData.forEach(data => {
        new CelestialBody(data);
    });
    CelestialBody.initAll();

    let light = new THREE.PointLight(0xffffff, 1, 0, 2);
    let Sun = CelestialBody.GetBodyByName('Sun');
    Sun.mesh.add(light);
    Sun.mesh.castShadow = false;
    Sun.mesh.receiveShadow = false;

    let cameraTarget = Sun.mesh;
    let cameraTargetLastPosition = new THREE.Vector3();

    function animer() {
        let deltaTime = clock.getDelta();
        let elapsedTime = clock.elapsedTime * 100000;

        //CelestialBody.updateAllRotation(elapsedTime);
        CelestialBody.updateAllPosition(elapsedTime);

        let dx = cameraTarget.position.x - cameraTargetLastPosition.x;
        let dy = cameraTarget.position.y - cameraTargetLastPosition.y;
        let dz = cameraTarget.position.z - cameraTargetLastPosition.z;
        camera.position.x += dx;
        camera.position.y += dy;
        camera.position.z += dz;
        cameraTargetLastPosition = cameraTarget.position.clone();

        control.update();
        renderer.render(scene, camera);
        requestAnimationFrame(animer);
    }

    // ajout des gestionnaires d'évènements
    this.addEventListener('resize', function () {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }, false);

    animer();

</script>
</body>
</html>